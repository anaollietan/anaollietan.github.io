(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,20995,e=>{"use strict";var t,a=((t={}).Available="Available",t.CheckedOut="CheckedOut",t.Deactivated="Deactivated",t);e.s(["EquipmentStatus",()=>a])},6211,e=>{"use strict";var t,a,s=((t={}).Calibration="Calibration",t.Inspection="Inspection",t),l=((a={}).Scheduled="Scheduled",a.InProgress="InProgress",a.Completed="Completed",a.Cancelled="Cancelled",a);e.s(["EventStatus",()=>l,"EventType",()=>s])},9522,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(6211),l=e.i(20995),n=e.i(85369),r=e.i(11110);function d({items:e,equipment:l,users:n,onEdit:d,onStart:i,onComplete:c}){let{t:u}=(0,r.useLanguage)(),[o,m]=(0,a.useState)(null),x=e=>e?new Date(e).toLocaleString():"-",p=(e,t,a)=>{if(!e||!t||!a)return null;let s=parseFloat(e),l=parseFloat(t),n=parseFloat(a);return isNaN(s)||isNaN(l)||isNaN(n)?null:s>=l&&s<=n};return(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,t.jsx)("thead",{className:"bg-gray-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:u("event.table.header.equipment")}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:u("event.table.header.type")}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:u("event.table.header.user")}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:u("event.table.header.scheduled_start")}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:u("event.table.header.scheduled_end")}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:u("event.table.header.status")}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:u("event.table.header.actions")})]})}),(0,t.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:0===e.length?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:7,className:"px-6 py-4 text-center text-gray-500",children:u("event.table.empty")})}):e.map(e=>{var r,h,g,f;let v,b,j,y,N;return(0,t.jsxs)(a.default.Fragment,{children:[(0,t.jsxs)("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>d(e),children:[(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:(r=e.EquipmentId,(v=l.find(e=>e.Id===r))?`${v.Name} (${v.SerialNumber})`:u("event.table.unknown"))}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(h=e.Type,b={[s.EventType.Calibration]:"bg-purple-100 text-purple-800",[s.EventType.Inspection]:"bg-blue-100 text-blue-800"},(0,t.jsx)("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${b[h]}`,children:h}))}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(g=e.UserId,(j=n.find(e=>e.Id===g))?j.Name:u("event.table.unknown"))}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:x(e.ScheduledStartAt)}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:x(e.ScheduledEndAt)}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(f=e.Status,y={[s.EventStatus.Scheduled]:"bg-gray-100 text-gray-800",[s.EventStatus.InProgress]:"bg-blue-100 text-blue-800",[s.EventStatus.Completed]:"bg-green-100 text-green-800",[s.EventStatus.Cancelled]:"bg-red-100 text-red-800"},N={[s.EventStatus.Scheduled]:u("event_status.scheduled"),[s.EventStatus.InProgress]:u("event_status.in_progress"),[s.EventStatus.Completed]:u("event_status.completed"),[s.EventStatus.Cancelled]:u("event_status.cancelled")},(0,t.jsx)("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${y[f]}`,children:N[f]}))}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,t.jsxs)("div",{className:"flex gap-2",children:[e.Status===s.EventStatus.Scheduled&&(0,t.jsx)("button",{onClick:t=>{t.stopPropagation(),i(e.Id)},className:"bg-blue-600 text-white px-3 py-1 rounded-md hover:bg-blue-700 transition-colors text-xs font-medium",children:u("button.start")}),e.Status===s.EventStatus.InProgress&&(0,t.jsx)("button",{onClick:t=>{t.stopPropagation(),c(e.Id)},className:"bg-green-600 text-white px-3 py-1 rounded-md hover:bg-green-700 transition-colors text-xs font-medium",children:u("button.complete")}),(0,t.jsx)("button",{onClick:t=>{var a;return a=e.Id,void(t.stopPropagation(),m(o===a?null:a))},className:"text-blue-600 hover:text-blue-800 font-medium text-xs",children:o===e.Id?u("button.hide"):u("button.details")})]})})]}),o===e.Id&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:7,className:"px-6 py-4 bg-gray-50",children:(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-6 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold text-gray-700 mb-3",children:u("event.table.details.scheduling_info")}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-medium",children:u("event.table.details.scheduled_start")})," ",x(e.ScheduledStartAt)]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-medium",children:u("event.table.details.scheduled_end")})," ",x(e.ScheduledEndAt)]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-medium",children:u("event.table.details.remind_before")})," ",e.RemindBefore," ",u("event.table.details.days")]}),e.Note&&(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsx)("span",{className:"font-medium",children:u("event.table.details.note")}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:e.Note})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold text-gray-700 mb-3",children:u("event.table.details.execution")}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-medium",children:u("event.table.details.started_at")})," ",x(e.StartedAt)]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-medium",children:u("event.table.details.ended_at")})," ",x(e.EndedAt)]}),(e.MeasuredValue||e.AcceptableMinValue||e.AcceptableMaxValue)&&(0,t.jsxs)("div",{className:"mt-3 p-3 bg-white rounded border border-gray-200",children:[(0,t.jsx)("h5",{className:"font-medium text-gray-700 mb-2",children:u("event.table.details.measurement")}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-medium",children:u("event.table.details.measured")}),(0,t.jsx)("span",{className:`ml-2 ${!0===p(e.MeasuredValue,e.AcceptableMinValue,e.AcceptableMaxValue)?"text-green-600 font-semibold":!1===p(e.MeasuredValue,e.AcceptableMinValue,e.AcceptableMaxValue)?"text-red-600 font-semibold":"text-gray-900"}`,children:e.MeasuredValue||"-"})]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-medium",children:u("event.table.details.min_acceptable")})," ",e.AcceptableMinValue||"-"]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-medium",children:u("event.table.details.max_acceptable")})," ",e.AcceptableMaxValue||"-"]}),!0===p(e.MeasuredValue,e.AcceptableMinValue,e.AcceptableMaxValue)&&(0,t.jsx)("p",{className:"text-green-600 text-xs mt-1",children:u("event.table.details.within_range")}),!1===p(e.MeasuredValue,e.AcceptableMinValue,e.AcceptableMaxValue)&&(0,t.jsx)("p",{className:"text-red-600 text-xs mt-1",children:u("event.table.details.outside_range")})]})]})]})]})]})})},`${e.Id}-details`)]},e.Id)})})]})})})}function i({statusFilter:e,userFilter:a,equipmentFilter:l,startedAfter:n,endedAfter:d,users:i,equipment:c,onStatusFilterChange:u,onUserFilterChange:o,onEquipmentFilterChange:m,onStartedAfterChange:x,onEndedAfterChange:p,onReset:h}){let g,{t:f}=(0,r.useLanguage)(),v=[{value:"All",label:f("event.filter.all_status")},{value:s.EventStatus.Scheduled,label:f("event_status.scheduled")},{value:s.EventStatus.InProgress,label:f("event_status.in_progress")},{value:s.EventStatus.Completed,label:f("event_status.completed")},{value:s.EventStatus.Cancelled,label:f("event_status.cancelled")}],b=(e,t)=>e?`${t}: ${f("event.filter.after")} ${new Date(e).toLocaleDateString()}`:`${t}: ${f("event.filter.any")}`,j=()=>"All"===e&&""===a&&(""===l||void 0===l)&&""===n&&""===d;return(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-4 mb-4",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-end gap-4 mb-4",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-[150px]",children:[(0,t.jsx)("label",{htmlFor:"status-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:f("event.filter.status")}),(0,t.jsx)("select",{id:"status-filter",value:e,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900",children:v.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("div",{className:"flex-1 min-w-[150px]",children:[(0,t.jsx)("label",{htmlFor:"user-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:f("event.filter.user")}),(0,t.jsxs)("select",{id:"user-filter",value:a,onChange:e=>o(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900",children:[(0,t.jsx)("option",{value:"",children:f("event.filter.all_users")}),i.map(e=>(0,t.jsx)("option",{value:e.Id,children:e.Name},e.Id))]})]}),c&&m&&(0,t.jsxs)("div",{className:"flex-1 min-w-[150px]",children:[(0,t.jsx)("label",{htmlFor:"equipment-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:f("event.filter.equipment")}),(0,t.jsxs)("select",{id:"equipment-filter",value:l||"",onChange:e=>m(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900",children:[(0,t.jsx)("option",{value:"",children:f("event.filter.all_equipment")}),c.map(e=>(0,t.jsx)("option",{value:e.Id,children:e.Name},e.Id))]})]}),(0,t.jsxs)("div",{className:"flex-1 min-w-[150px]",children:[(0,t.jsx)("label",{htmlFor:"started-after-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:f("event.filter.started_after")}),(0,t.jsx)("input",{type:"date",id:"started-after-filter",value:n,onChange:e=>x(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900"})]}),(0,t.jsxs)("div",{className:"flex-1 min-w-[150px]",children:[(0,t.jsx)("label",{htmlFor:"ended-after-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:f("event.filter.ended_after")}),(0,t.jsx)("input",{type:"date",id:"ended-after-filter",value:d,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900"})]}),(0,t.jsx)("div",{children:(0,t.jsx)("button",{onClick:h,disabled:j(),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${j()?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-gray-600 text-white hover:bg-gray-700"}`,children:f("button.reset_filters")})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-gray-700",children:f("event.filter.active")}),(0,t.jsx)("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:(g=v.find(t=>t.value===e))?g.label:e}),(0,t.jsx)("span",{className:"px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-medium",children:(e=>{if(!e)return f("event.filter.all_users");let t=i.find(t=>t.Id===e);return t?t.Name:f("event.filter.all_users")})(a)}),c&&(0,t.jsx)("span",{className:"px-3 py-1 bg-indigo-100 text-indigo-800 rounded-full text-sm font-medium",children:(e=>{if(!e)return f("event.filter.all_equipment");let t=c?.find(t=>t.Id===e);return t?t.Name:f("event.filter.all_equipment")})(l||"")}),(0,t.jsx)("span",{className:"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium",children:b(n,f("event.filter.started_prefix"))}),(0,t.jsx)("span",{className:"px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm font-medium",children:b(d,f("event.filter.ended_prefix"))})]})]})}function c(){let{t:e}=(0,r.useLanguage)(),[c,u]=(0,a.useState)([]),[o,m]=(0,a.useState)([]),[x,p]=(0,a.useState)([]),[h,g]=(0,a.useState)(null),[f,v]=(0,a.useState)("All"),[b,j]=(0,a.useState)(""),[y,N]=(0,a.useState)(""),[S,w]=(0,a.useState)(""),[I,A]=(0,a.useState)("");(0,a.useEffect)(()=>{E();let e=new URLSearchParams(window.location.search).get("equipmentId");e&&N(e)},[]);let E=()=>{let e=n.eventStorage.getAll(),t=n.equipmentStorage.getAll(),a=n.userStorage.getAll();e.sort((e,t)=>new Date(t.ScheduledStartAt).getTime()-new Date(e.ScheduledStartAt).getTime()),u(e),m(t),p(a)},C=c.filter(e=>{let t="All"===f||e.Status===f,a=!b||e.UserId===b,s=!y||e.EquipmentId===y,l=!S||e.StartedAt&&new Date(e.StartedAt)>=new Date(S),n=!I||e.EndedAt&&new Date(e.EndedAt)>=new Date(I);return t&&a&&s&&l&&n});return(0,t.jsxs)("div",{className:"h-full overflow-y-auto",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-6 text-gray-800",children:e("page.event_log.title")}),(0,t.jsxs)("div",{className:"overflow-auto",children:[(0,t.jsx)(i,{statusFilter:f,userFilter:b,equipmentFilter:y,startedAfter:S,endedAfter:I,users:x,equipment:o,onStatusFilterChange:v,onUserFilterChange:j,onEquipmentFilterChange:N,onStartedAfterChange:w,onEndedAfterChange:A,onReset:()=>{v("All"),j(""),N(""),w(""),A("")}}),(0,t.jsx)(d,{items:C,equipment:o,users:x,onEdit:e=>{window.location.href=`/event?editId=${e.Id}`},onStart:e=>{let t=n.eventStorage.getById(e);if(t){let a={...t,Status:s.EventStatus.InProgress,StartedAt:new Date().toISOString().slice(0,16)};n.eventStorage.update(e,a);let l={UserId:a.UserId,EquipmentId:a.EquipmentId,CheckedOutAt:new Date().toISOString(),CheckedInAt:null,ReferenceType:"Event",ReferenceId:e};n.checkoutLogStorage.create(l),E()}},onComplete:e=>{let t=n.eventStorage.getById(e);if(t){let a={...t,Status:s.EventStatus.Completed,EndedAt:new Date().toISOString().slice(0,16)};n.eventStorage.update(e,a),n.checkoutLogStorage.checkInByReferenceId(e);let r=n.equipmentStorage.getById(t.EquipmentId);r&&n.equipmentStorage.update(t.EquipmentId,{...r,Status:l.EquipmentStatus.Available}),E()}}})]})]})}e.s(["default",()=>c],9522)}]);